<!DOCTYPE html>
<head>
    <title>Home</title>
    <meta charset="utf-8">
    <style>

      path {
        stroke-linejoin: round;
        stroke-linecap: round;
      }

      svg {
        display: block;
        margin-left: auto;
        margin-right: 45%;
      }

      .districts {
        fill: #bbb;
      }

      .districts :hover {
        fill: #e11a88;
      }

      .district-boundaries {
        pointer-events: none;
        fill: none;
        stroke: #fff;
        stroke-width: .5px;
      }

      .state-boundaries {
        pointer-events: none;
        fill: none;
        stroke: #fff;
        stroke-width: 1.25px;
      }

      #graph-container {
        float: right;
        margin-top: 110px;
        margin-right: 20px;
        padding: 10px;
      }

    </style>

</head>

  <body>

      <!-- JQuery -->
      <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
      <!-- d3.js -->
      <script type="text/javascript" src="static/d3/d3.min.js"></script>
      <script src="static/js/queue.v1.min.js"></script>
      <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
      <script type="text/javascript" src="static/js/d3-geo.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.0/topojson.min.js"></script>
      <!-- Chart.js -->
      <script src= "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

      <!-- <div> containing buttons to update map data. -->
      <div id="option">
          <button type="submit" onclick="womenEmployeesData()">
            All Employees (% Women)</button>

          <button type="submit" onclick="womenManagersData()">
            Managers (% Women)</button>

          <button type="submit" onclick="womenEmployeesDataReverse()">Lowest 5 for Employees
          </button>

          <button type="submit" onclick="womenManagersDataReverse()">Lowest 5 for Managers
          </button>
      </div>

    
    <!-- canvas for chart with top/bottom 5 % female employees -->
    <div id="graph-container">
    <canvas id="district-rank" width="300" height="300"></canvas>
    </div>

    <!-- input form for zipcode lookup add button -->
    <br>
    <form id="zipcode-form" action="/zipcode-lookup.json">
    Find District by Zipcode: 
    <input id="zipcode-entry" type="text" name="zipcode-entry">
    <input type="submit" value="Submit">
    </form>

    <p id="display-zip-result"></p>
    <p id="display-percent-result"></p>

    <script type="text/javascript">

      function zipcodeLookup(results) {
          console.log(results);
          var zip = results;
          $("#display-zip-result").html("This zipcode is in " + results.lookup_state + 
                                        " district number " + results.lookup_dist + ".")
          $("#display-percent-result").html("% employed persons women: " + 
                                            results.lookup_percent);
         
          console.log("***finished zipcodeLookup***");
      }

      function getDistrictId(evt) {
          evt.preventDefault();
          var zipcode = $("#zipcode-entry").val();
          $.get("/zipcode-lookup.json",{"zipcode-entry":zipcode}, zipcodeLookup);
          console.log("***finished AJAX request***");
      }

      $("#zipcode-form").submit(getDistrictId);

    </script>

    <!-- begin d3 visualization -->
    <script type="text/javascript">

    var width = 960,
        height = 600;

    // define color scale
    var minimumColor = "#edf8fb",
        maximumColor = "#005824";

    var projection = d3.geoAlbersUsa()
      .scale(1280)
      .translate([width / 2, height / 2]);

    var path = d3.geoPath()
        .projection(projection);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    // minimum & maximum population values
    var minimum = 0.28,
        maximum = 0.62;

    var color = d3.scaleLinear().domain([minimum, maximum])
    .range([minimumColor, maximumColor]);

    // load data
    queue()
        .defer(d3.json, "/us.json")
        .defer(d3.json, "/us-congress-113.json")
        .defer(d3.json, "/district-manager-info.json")
        .await(ready);

    // bind data to visual elements
    function ready(error, us, congress, district) {
      if (error) throw error;

      svg.append("defs").append("path")
          .attr("id", "land")
          .datum(topojson.feature(us, us.objects.land))
          .attr("d", path);

      svg.append("clipPath")
          .attr("id", "clip-land")
        .append("use")
          .attr("xlink:href", "#land");
          
      // congressional districts
      svg.append("g")
          .attr("class", "districts")
          .attr("clip-path", "url(#clip-land)")
          .selectAll("path")
          .data(topojson.feature(congress, congress.objects.districts).features)
      .enter().append("path")
          .attr("d", path)
          .style("fill", function (d) {
            if (district[d.id]) {
              return color(district[d.id]); }
            else {
              return "#F2F3F4"; }
          })

        // show congressional district id on hover
        .append("title")
          .text(function(d) { return d.id; });

      // draw district & state boundaries
      svg.append("path")
          .attr("class", "district-boundaries")
          .datum(topojson.mesh(congress, congress.objects.districts,
            function(a, b) { return a !== b && (a.id / 1000 | 0) === (b.id / 1000 | 0); }))
          .attr("d", path);

      svg.append("path")
          .attr("class", "state-boundaries")
          .datum(topojson.mesh(us, us.objects.states,
            function(a, b) { return a !== b; }))
          .attr("d", path);
      
        d3.select(self.frameElement).style("height", height + "px");

      } // end ready

      createRankChartManager();

  // populate map with data showing % women employed overall by district
  function womenEmployeesData() {
  
    //draw chartjs chart

    $("#district-rank").remove();
    $("#graph-container").append("<canvas id='district-rank' width=300, height=300></canvas>");
    var ctx = $("#district-rank")
    createRankChartEmployee();
    
    var minimum = 0.33,
        maximum = 0.52;

      queue()
      .defer(d3.json, "/us.json")
      .defer(d3.json, "/us-congress-113.json")
      .defer(d3.json, "/district-employee-info.json")
      .await(ready);

  } // end womenEmployeesData

  function womenEmployeesDataReverse() {
  
    //draw chartjs chart

    $("#district-rank").remove();
    $("#graph-container").append("<canvas id='district-rank' width=300, height=300></canvas>");
    createReverseChartEmployee();
    
    var minimum = 0.33,
        maximum = 0.52;

      queue()
      .defer(d3.json, "/us.json")
      .defer(d3.json, "/us-congress-113.json")
      .defer(d3.json, "/district-employee-info.json")
      .await(ready);

  } // end womenEmployeesData


  // populate map with data showing % women employed in management positions by district
  function womenManagersData() {
        
        // draw chartjs chart
        $("#district-rank").remove();
        $("#graph-container").append("<canvas id='district-rank' width=300, height=300></canvas>");
        var ctx = $("#district-rank")
        createRankChartManager();

        var minimum = 0.28,
            maximum = 0.62;

        queue()
        .defer(d3.json, "/us.json")
        .defer(d3.json, "/us-congress-113.json")
        .defer(d3.json, "/district-manager-info.json")
        .await(ready);
        // debugger

  } // end womenManagersData

  function womenManagersDataReverse() {
        
        // draw chartjs chart
        $("#district-rank").remove();
        $("#graph-container").append("<canvas id='district-rank' width=300, height=300</canvas>");
        var ctx = $("#district-rank")
        createReverseChartManager();

        var minimum = 0.28,
            maximum = 0.62;

        queue()
        .defer(d3.json, "/us.json")
        .defer(d3.json, "/us-congress-113.json")
        .defer(d3.json, "/district-manager-info.json")
        .await(ready);
        // debugger

  } // end womenManagersData


  // create bar chart
  function createRankChartEmployee() {
      var ctx = $("#district-rank");
      
      $.get("/chart-data-employee", function (results) {
        var data = {
          labels: results[0],
          datasets: [
          {
            data: results[1],
          }]
        };

        var districtRankChart = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
              responsive: false,
              title: {
                  display: true,
                  text: 'Districts With Highest % Female Employees'
                }}
              });
      })
    };


  function createReverseChartEmployee() {
      var ctx = $("#district-rank");
      
      $.get("/chart-data-employee-reverse", function (results) {
        var data = {
          labels: results[0],
          datasets: [
          {
            data: results[1],
          }]
        };

        var districtRankChart = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
              responsive: false,
              title: {
                  display: true,
                  text: 'Districts With Lowest % Female Employees'
                }}
              });
      })
    };


  function createRankChartManager() {
      var ctx = $("#district-rank");
      
      $.get("/chart-data-manager", function (results) {
        var data = {
          labels: results[0],
          datasets: [
          {
            data: results[1],
          }]
        };

        var districtRankChart = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
              responsive: false,
              title: {
                  display: true,
                  text: 'Districts With Highest % Female Employees in Management'
                }}
              });
      })
    };
  
  function createReverseChartManager() {
      var ctx = $("#district-rank");

      $.get("/chart-data-manager-reverse", function (results) {
        var data = {
          labels: results[0],
          datasets: [
          {
            data: results[1],
          }]
        };

        var districtRankChart = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
              responsive: false,
              title: {
                  display: true,
                  text: 'Districts With Lowest % Female Employees in Management'
                }}
              });
      })
    };

    </script>

  </body>
</html>